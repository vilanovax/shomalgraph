generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
  BUSINESS_OWNER
}

enum PlaceType {
  NATURE
  HISTORICAL
  ENTERTAINMENT
  CULTURAL
  BEACH
  MOUNTAIN
  FOREST
  WATERFALL
  PARK
  OTHER
}

enum RestaurantPriceRange {
  BUDGET      // ارزان
  MODERATE    // متوسط
  EXPENSIVE   // گران
  LUXURY      // لاکچری
}

enum SuitableFor {
  FAMILY
  COUPLE
  FRIENDS
  SOLO
  KIDS
}

model User {
  id            String    @id @default(cuid())
  phone         String    @unique
  name          String?
  avatar        String?
  role          UserRole  @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  reviews       Review[]
  favorites     Favorite[]
  suggestions   Suggestion[]
  restaurants   Restaurant[]  @relation("RestaurantOwner")

  // Explore Lists Relations
  lists         List[]        @relation("ListCreator")
  itemLikes     ItemLike[]    @relation("ItemLikes")
  itemDislikes  ItemDislike[] @relation("ItemDislikes")
  itemComments  ItemComment[] @relation("ItemComments")
  commentLikes  CommentLike[] @relation("CommentLikes")
  commentReports CommentReport[] @relation("CommentReports")
  listLikes     ListLike[]    @relation("ListLikes")
  itemSuggestions ItemSuggestion[] @relation("ItemSuggestions")

  @@index([phone])
  @@map("users")
}

model Category {
  id            String    @id @default(cuid())
  name          String
  slug          String    @unique
  icon          String?
  description   String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  restaurants   Restaurant[]
  places        TouristPlace[]

  @@map("categories")
}

model Restaurant {
  id              String                @id @default(cuid())
  name            String
  slug            String                @unique
  description     String?
  address         String
  latitude        Float
  longitude       Float
  phone           String?
  priceRange      RestaurantPriceRange  @default(MODERATE)
  rating          Float                 @default(0)
  reviewCount     Int                   @default(0)
  images          String[]              @default([])
  menuImages      String[]              @default([])
  workingHours    Json?
  isVerified      Boolean               @default(false)
  isActive        Boolean               @default(true)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  // Relations
  categoryId      String?
  category        Category?             @relation(fields: [categoryId], references: [id])
  ownerId         String?
  owner           User?                 @relation("RestaurantOwner", fields: [ownerId], references: [id])
  reviews         Review[]
  favorites       Favorite[]
  listItems       ListItem[]

  @@index([latitude, longitude])
  @@index([slug])
  @@index([categoryId])
  @@map("restaurants")
}

model TouristPlace {
  id              String        @id @default(cuid())
  name            String
  slug            String        @unique
  description     String?
  address         String
  latitude        Float
  longitude       Float
  placeType       PlaceType     @default(OTHER)
  suitableFor     SuitableFor[] @default([])
  rating          Float         @default(0)
  reviewCount     Int           @default(0)
  images          String[]      @default([])
  entryFee        Float?
  isFree          Boolean       @default(true)
  workingHours    Json?
  isVerified      Boolean       @default(false)
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  categoryId      String?
  category        Category?     @relation(fields: [categoryId], references: [id])
  reviews         Review[]
  favorites       Favorite[]
  listItems       ListItem[]

  @@index([latitude, longitude])
  @@index([slug])
  @@index([placeType])
  @@map("tourist_places")
}

model Review {
  id              String    @id @default(cuid())
  rating          Int       // 1-5
  comment         String?
  images          String[]  @default([])
  isVerified      Boolean   @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurantId    String?
  restaurant      Restaurant? @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  placeId         String?
  place           TouristPlace? @relation(fields: [placeId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([restaurantId])
  @@index([placeId])
  @@map("reviews")
}

model Favorite {
  id              String    @id @default(cuid())
  createdAt       DateTime  @default(now())

  // Relations
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurantId    String?
  restaurant      Restaurant? @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  placeId         String?
  place           TouristPlace? @relation(fields: [placeId], references: [id], onDelete: Cascade)

  @@unique([userId, restaurantId])
  @@unique([userId, placeId])
  @@index([userId])
  @@map("favorites")
}

model Suggestion {
  id              String    @id @default(cuid())
  type            String    // "restaurant" | "place"
  data            Json      // اطلاعات پیشنهادی
  comment         String?
  status          String    @default("pending") // pending, approved, rejected
  adminComment    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("suggestions")
}

// ==================== Explore Lists Feature ====================

enum ListType {
  PUBLIC    // لیست‌های عمومی (ادمین)
  PRIVATE   // لیست‌های شخصی (کاربر)
}

model List {
  id            String    @id @default(cuid())
  title         String
  description   String?
  slug          String    @unique
  type          ListType  @default(PUBLIC)
  coverImage    String?
  keywords      String[]  @default([])

  createdById   String
  createdBy     User      @relation("ListCreator", fields: [createdById], references: [id], onDelete: Cascade)

  items         ListItem[]
  likes         ListLike[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([type])
  @@index([createdById])
  @@map("lists")
}

model ListItem {
  id            String    @id @default(cuid())
  listId        String
  list          List      @relation(fields: [listId], references: [id], onDelete: Cascade)

  // آیتم می‌تونه رستوران یا مکان باشه
  restaurantId  String?
  restaurant    Restaurant? @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  placeId       String?
  place         TouristPlace? @relation(fields: [placeId], references: [id], onDelete: Cascade)

  order         Int       // ترتیب نمایش در لیست
  note          String?   // یادداشت ادمین درباره این آیتم

  likes         ItemLike[]
  dislikes      ItemDislike[]
  comments      ItemComment[]

  createdAt     DateTime  @default(now())

  @@index([listId])
  @@map("list_items")
}

model ItemLike {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation("ItemLikes", fields: [userId], references: [id], onDelete: Cascade)
  itemId    String
  item      ListItem  @relation(fields: [itemId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now())

  @@unique([userId, itemId])
  @@index([itemId])
  @@map("item_likes")
}

model ItemDislike {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation("ItemDislikes", fields: [userId], references: [id], onDelete: Cascade)
  itemId    String
  item      ListItem  @relation(fields: [itemId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now())

  @@unique([userId, itemId])
  @@index([itemId])
  @@map("item_dislikes")
}

model ItemComment {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation("ItemComments", fields: [userId], references: [id], onDelete: Cascade)
  itemId    String
  item      ListItem  @relation(fields: [itemId], references: [id], onDelete: Cascade)
  comment   String

  likes     CommentLike[]
  reports   CommentReport[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([itemId])
  @@map("item_comments")
}

model CommentLike {
  id        String      @id @default(cuid())
  userId    String
  user      User        @relation("CommentLikes", fields: [userId], references: [id], onDelete: Cascade)
  commentId String
  comment   ItemComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  createdAt DateTime    @default(now())

  @@unique([userId, commentId])
  @@index([commentId])
  @@map("comment_likes")
}

model CommentReport {
  id        String      @id @default(cuid())
  userId    String
  user      User        @relation("CommentReports", fields: [userId], references: [id], onDelete: Cascade)
  commentId String
  comment   ItemComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  reason    String
  status    String      @default("pending") // pending, reviewed, resolved
  createdAt DateTime    @default(now())

  @@index([commentId])
  @@index([status])
  @@map("comment_reports")
}

model ListLike {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation("ListLikes", fields: [userId], references: [id], onDelete: Cascade)
  listId    String
  list      List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, listId])
  @@index([listId])
  @@map("list_likes")
}

model ItemSuggestion {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation("ItemSuggestions", fields: [userId], references: [id], onDelete: Cascade)
  listId      String?  // لیست پیشنهادی (اختیاری)

  // آیتم پیشنهادی
  restaurantId String?
  placeId      String?

  note        String?  // توضیحات کاربر
  adminNote   String?  // پاسخ ادمین
  status      String   @default("pending") // pending, approved, rejected

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@map("item_suggestions")
}

// ==================== Settings ====================

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String?
  category  String   @default("general") // general, api, storage, etc.
  description String?
  isSecret  Boolean  @default(false) // برای کلیدهای API که نباید نمایش داده شوند
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([key])
  @@map("settings")
}
